<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>RestRserve: A Framework for Building HTTP API — RestRserve-package • RestRserve</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="RestRserve: A Framework for Building HTTP API — RestRserve-package"><meta property="og:description" content="
Allows to easily create high-performance full featured HTTP APIs from R functions. Provides high-level classes such as 'Request', 'Response', 'Application', 'Middleware' in order to streamline server side application development. Out of the box allows to serve requests using 'Rserve' package, but flexible enough to integrate with other HTTP servers such as 'httpuv'."><meta property="og:image" content="https://restrserve.org/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">RestRserve</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/RestRserve.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Authentication.html">Authentication</a>
    </li>
    <li>
      <a href="../articles/ContentHandlers.html">Body encoding and decoding</a>
    </li>
    <li>
      <a href="../articles/Logging.html">Logging</a>
    </li>
    <li>
      <a href="../articles/Middleware.html">Middleware</a>
    </li>
    <li>
      <a href="../articles/benchmarks/Benchmarks.html">Benchmarks</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/rexyai/RestRserve/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>RestRserve: A Framework for Building HTTP API</h1>
    <small class="dont-index">Source: <a href="https://github.com/rexyai/RestRserve/blob/HEAD/R/RestRserve-package.R" class="external-link"><code>R/RestRserve-package.R</code></a></small>
    <div class="hidden name"><code>RestRserve-package.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><img src="figures/logo.png" align="right" alt="logo" width="120"></p>
<p>Allows to easily create high-performance full featured HTTP APIs from R functions. Provides high-level classes such as 'Request', 'Response', 'Application', 'Middleware' in order to streamline server side application development. Out of the box allows to serve requests using 'Rserve' package, but flexible enough to integrate with other HTTP servers such as 'httpuv'.</p>
    </div>


    <div id="details">
    <h2>Details</h2>
    
<div class="section">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a></h3>


<p>Suppose you’ve developed a very useful algorithm or statistical model
and you need to integrate it with some external system. Nowadays HTTP
became de facto a lingua-franca for this kind of tasks.</p>
<p>In this article we will demonstrate how to use RestRserve to build a
basic REST API.</p>
</div>

<div class="section">
<h3 id="workflow-overview">Workflow overview<a class="anchor" aria-label="anchor" href="#workflow-overview"></a></h3>


<p>Generally RestRserve workflow consists of several major steps:</p><ol><li><p>Create application with <code>Application$new()</code></p></li>
<li><p>Create a function which follows RestRserve API:</p><ul><li><p>should take 2 arguments - <code>request</code> and <code>response</code> as an input.
<code>request</code> and <code>response</code> are instances of <code><a href="Request.html">RestRserve::Request</a></code>
and <code><a href="Response.html">RestRserve::Response</a></code>. It is <strong>important to remember</strong> that
both <code>request</code> and <code>response</code> are <strong>mutable</strong> objects.</p></li>
<li><p>should modify <code>response</code> in place or <code><a href="raise.html">raise()</a></code> exception in case
of error</p></li>
</ul></li>
<li><p>Register this function as a handler for an endpoint</p></li>
<li><p>Start application</p></li>
</ol></div>

<div class="section">
<h3 id="-create-application">1. Create application<a class="anchor" aria-label="anchor" href="#-create-application"></a></h3>
<p></p><div class="r"><div class="sourceCode"><pre><code><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://restrserve.org">RestRserve</a></span><span class="op">)</span>
<span class="va">app</span> <span class="op">=</span> <span class="va"><a href="../reference/Application.html">Application</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></code></pre></div><p></p></div>
</div>

<div class="section">
<h3 id="-define-logic">2. Define logic<a class="anchor" aria-label="anchor" href="#-define-logic"></a></h3>


<p>For simplicity we will use Fibonacci number calculation as an algorithm
we want to expose.</p><div class="r"><div class="sourceCode"><pre><code><span class="va">calc_fib</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">n</span> <span class="op">&lt;</span> <span class="fl">0L</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"n should be &gt;= 0"</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">n</span> <span class="op">==</span> <span class="fl">0L</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fl">0L</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">n</span> <span class="op">==</span> <span class="fl">1L</span> <span class="op">||</span> <span class="va">n</span> <span class="op">==</span> <span class="fl">2L</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fl">1L</span><span class="op">)</span>
  <span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="va">n</span><span class="op">)</span>
  
  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">3L</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span>
   <span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="va">x</span><span class="op">[[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="va">x</span><span class="op">[[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">2</span><span class="op">]</span><span class="op">]</span> 
  <span class="op">}</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">n</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span></code></pre></div><p></p></div>
<p>Create function which will handle requests.</p><div class="r"><div class="sourceCode"><pre><code><span class="va">fib_handler</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">.req</span>, <span class="va">.res</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">.req</span><span class="op">$</span><span class="va">parameters_query</span><span class="op">[[</span><span class="st">"n"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0L</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="../reference/raise.html">raise</a></span><span class="op">(</span><span class="va">HTTPError</span><span class="op">$</span><span class="fu">bad_request</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">.res</span><span class="op">$</span><span class="fu">set_body</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu">calc_fib</span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">.res</span><span class="op">$</span><span class="fu">set_content_type</span><span class="op">(</span><span class="st">"text/plain"</span><span class="op">)</span>
<span class="op">}</span></code></pre></div><p></p></div>
<p>You may have noticed strange <code>.req</code> and <code>.res</code> argument names. Starting
from <code>RestRserve</code> v0.4.0 these “reserved” names allows to benefit from
autocomplete:
<img src="https://cdn.rexy.ai/assets/req-res.gif" width="100%" style="vertical-align:bottom"></p>

<p>Technically <code>.req</code> and <code>.res</code> are just empty instances of <code><a href="Request.html">?Request</a></code> and
<code><a href="Response.html">?Response</a></code> classes exported by <code>RestRserve</code> in order to make
autocomplete work.</p>
</div>

<div class="section">
<h3 id="-register-endpoint">2. Register endpoint<a class="anchor" aria-label="anchor" href="#-register-endpoint"></a></h3>
<p></p><div class="r"><div class="sourceCode"><pre><code><span class="va">app</span><span class="op">$</span><span class="fu">add_get</span><span class="op">(</span>path <span class="op">=</span> <span class="st">"/fib"</span>, FUN <span class="op">=</span> <span class="va">fib_handler</span><span class="op">)</span></code></pre></div><p></p></div>
</div>

<div class="section">
<h3 id="-test-endpoints">3. Test endpoints<a class="anchor" aria-label="anchor" href="#-test-endpoints"></a></h3>


<p>Now we can test our application without starting it:</p><div class="r"><div class="sourceCode"><pre><code><span class="va">request</span> <span class="op">=</span> <span class="va"><a href="../reference/Request.html">Request</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>path <span class="op">=</span> <span class="st">"/fib"</span>, parameters_query <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="va">response</span> <span class="op">=</span> <span class="va">app</span><span class="op">$</span><span class="fu">process_request</span><span class="op">(</span><span class="va">request</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Response status:"</span>, <span class="va">response</span><span class="op">$</span><span class="va">status</span><span class="op">)</span>
<span class="co">#&gt; Response status: 200 OK</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Response body:"</span>, <span class="va">response</span><span class="op">$</span><span class="va">body</span><span class="op">)</span>
<span class="co">#&gt; Response body: 55</span></code></pre></div><p></p></div>
<p>It is generally a good idea to write unit tests against application. One
can use a common framework such as
<a href="https://cran.r-project.org/package=tinytest" class="external-link">tinytest</a>.</p>
</div>

<div class="section">
<h3 id="-add-openapi-description-and-swagger-ui">4. Add OpenAPI description and Swagger UI<a class="anchor" aria-label="anchor" href="#-add-openapi-description-and-swagger-ui"></a></h3>


<p>Generally it is a good idea to provide documentation along with the API.
Convenient way to do that is to supply a <a href="https://swagger.io/docs/specification/about/" class="external-link">openapi specification</a>. This as
simple as adding a yaml file as an additional endpoint:</p><div class="yaml"><div class="sourceCode"><pre><code>openapi: 3.0.1
info:
  title: RestRserve OpenAPI
  version: '1.0'
servers:
  - url: /
paths:
  /fib:
    get:
      description: Calculates Fibonacci number
      parameters:
        - name: "n"
          description: "x for Fibonnacci number"
          in: query
          schema:
            type: integer
          example: 10
          required: true
      responses:
        200:
          description: API response
          content:
            text/plain:
              schema:
                type: string
                example: 5
        400:
          description: Bad Request
</code></pre></div><p></p></div><div class="r"><div class="sourceCode"><pre><code><span class="va">yaml_file</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples"</span>, <span class="st">"openapi"</span>, <span class="st">"openapi.yaml"</span>, package <span class="op">=</span> <span class="st">"RestRserve"</span><span class="op">)</span>
<span class="va">app</span><span class="op">$</span><span class="fu">add_openapi</span><span class="op">(</span>path <span class="op">=</span> <span class="st">"/openapi.yaml"</span>, file_path <span class="op">=</span> <span class="va">yaml_file</span><span class="op">)</span>
<span class="va">app</span><span class="op">$</span><span class="fu">add_swagger_ui</span><span class="op">(</span>path <span class="op">=</span> <span class="st">"/doc"</span>, path_openapi <span class="op">=</span> <span class="st">"/openapi.yaml"</span>, use_cdn <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div><p></p></div>
</div>

<div class="section">
<h3 id="-start-the-app">5. Start the app<a class="anchor" aria-label="anchor" href="#-start-the-app"></a></h3>


<p>Now all is ready and we can start application with Rserve backend. It
will block R session and start listening for incoming requests.</p><div class="r"><div class="sourceCode"><pre><code><span class="va">backend</span> <span class="op">=</span> <span class="va"><a href="../reference/BackendRserve.html">BackendRserve</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>
<span class="va">backend</span><span class="op">$</span><span class="fu">start</span><span class="op">(</span><span class="va">app</span>, http_port <span class="op">=</span> <span class="fl">8080</span><span class="op">)</span></code></pre></div><p></p></div>
</div>

<div class="section">
<h3 id="-test-it">6. Test it<a class="anchor" aria-label="anchor" href="#-test-it"></a></h3>


<p>Send request to calculate fibonacci number:</p><div class="bash"><div class="sourceCode"><pre><code>curl localhost:8080/fib?n=10
</code></pre></div><p></p></div>
<p>Check out a swagger UI in the browser: <code>http://localhost:8080/doc</code></p>
</div>

    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>Useful links:</p><ul><li><p><a href="https://restrserve.org">https://restrserve.org</a></p></li>
<li><p><a href="https://github.com/rexyai/RestRserve" class="external-link">https://github.com/rexyai/RestRserve</a></p></li>
<li><p>Report bugs at <a href="https://github.com/rexyai/RestRserve/issues" class="external-link">https://github.com/rexyai/RestRserve/issues</a></p></li>
</ul></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p><strong>Maintainer</strong>: Dmitry Selivanov <a href="mailto:ds@rexy.ai">ds@rexy.ai</a> (<a href="https://orcid.org/0000-0001-5413-1506" class="external-link">ORCID</a>)</p>
<p>Authors:</p><ul><li><p>Artem Klevtsov <a href="mailto:a.a.klevtsov@gmail.com">a.a.klevtsov@gmail.com</a> (<a href="https://orcid.org/0000-0003-0492-6647" class="external-link">ORCID</a>)</p></li>
</ul><p>Other contributors:</p><ul><li><p>David Zimmermann <a href="mailto:david_j_zimmermann@hotmail.com">david_j_zimmermann@hotmail.com</a> [contributor]</p></li>
<li><p>rexy.ai [copyright holder, funder]</p></li>
</ul></div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Dmitry Selivanov, Artem Klevtsov, <a href="https://rexy.ai" class="external-link"></a><a href="https://rexy.ai" class="external-link"><img src="https://s3-eu-west-1.amazonaws.com/rexy.ai/images/rexy-logo.svg" height="32" alt="rexy.ai"></a>.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer></div>

  


  

  </body></html>

